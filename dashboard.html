<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة التحكم - Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f0f4f8;
      padding: 20px;
      margin: 0;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    h2 {
      text-align: center;
      color: #5e6a7b;
      margin-bottom: 40px;
    }

    input, textarea, select, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 16px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    .section-title {
      margin-top: 30px;
      font-size: 22px;
      color: #4CAF50;
    }

    .item-box {
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
    }

    .delete-btn {
      background-color: red;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .delete-btn:hover {
      background-color: #d32f2f;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      gap: 15px;
    }

    .form-column {
      flex: 1;
    }

    .form-column input, .form-column textarea, .form-column select {
      width: 100%;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>لوحة التحكم - إضافة مادة / محاضرة / سؤال</h2>

    <!-- إضافة مادة -->
    <div class="form-row">
      <div class="form-column">
        <input type="text" id="subjectName" placeholder="اسم المادة" />
      </div>
      <div class="form-column">
        <button onclick="addSubject()">إضافة مادة</button>
      </div>
    </div>

    <!-- إضافة محاضرة -->
    <div class="form-row">
      <div class="form-column">
        <input type="text" id="lectureName" placeholder="اسم المحاضرة" />
      </div>
      <div class="form-column">
        <select id="subjectSelect" onchange="loadLecturesForSubject()">
          <option value="">اختر المادة</option>
        </select>
        <button onclick="addLecture()">إضافة محاضرة</button>
      </div>
    </div>

    <!-- إضافة سؤال -->
    <div class="form-row">
      <div class="form-column">
        <select id="subjectSelectForQuestion" onchange="loadLecturesForQuestion()">
          <option value="">اختر المادة</option>
        </select>
      </div>
      <div class="form-column">
        <select id="lectureSelectForQuestion">
          <option value="">اختر المحاضرة</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-column">
        <textarea id="questionText" placeholder="نص السؤال" rows="3"></textarea>
      </div>
      <div class="form-column">
        <textarea id="optionsText" placeholder="اكتب 5 خيارات كل واحد في سطر" rows="5"></textarea>
      </div>
    </div>

    <div class="form-row">
      <div class="form-column">
        <select id="correctOption">
          <option value="">اختر الإجابة الصحيحة</option>
          <option value="0">الخيار 1</option>
          <option value="1">الخيار 2</option>
          <option value="2">الخيار 3</option>
          <option value="3">الخيار 4</option>
          <option value="4">الخيار 5</option>
        </select>
      </div>
      <div class="form-column">
        <button onclick="addQuestion()">إضافة سؤال</button>
      </div>
    </div>

    <div id="msg"></div>

    <!-- عرض المواد والمعلومات -->
    <div class="section-title">جميع المواد:</div>
    <div id="subjectsList"></div>
  </div>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyBfaMxkaF-QRPdf24gYCJKeLMarNNQLaBQ",
  authDomain: "storage-5ba27.firebaseapp.com",
  projectId: "storage-5ba27",
  storageBucket: "storage-5ba27.firebasestorage.app",
  messagingSenderId: "911744755254",
  appId: "1:911744755254:web:b05fea1f2d26ba9738da97",
  measurementId: "G-SVE6LCGBGE"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // إضافة مادة
    async function addSubject() {
      const subjectName = document.getElementById("subjectName").value;
      if (!subjectName) {
        alert("يرجى إدخال اسم المادة");
        return;
      }

      await db.collection("subjects").add({ name: subjectName });
      document.getElementById("subjectName").value = "";
      loadSubjects();
    }

    // إضافة محاضرة
    async function addLecture() {
      const lectureName = document.getElementById("lectureName").value;
      const subjectName = document.getElementById("subjectSelect").value;

      if (!lectureName || !subjectName) {
        alert("يرجى اختيار المادة وإدخال اسم المحاضرة");
        return;
      }

      await db.collection("subjects").doc(subjectName).collection("lectures").add({ name: lectureName });
      document.getElementById("lectureName").value = "";
      loadLecturesForSubject();
    }

    // إضافة سؤال
    async function addQuestion() {
      const questionText = document.getElementById("questionText").value;
      const optionsText = document.getElementById("optionsText").value.trim().split("\n");
      const correctOption = parseInt(document.getElementById("correctOption").value);
      const subjectName = document.getElementById("subjectSelectForQuestion").value;
      const lectureName = document.getElementById("lectureSelectForQuestion").value;

      if (!questionText || optionsText.length !== 5 || isNaN(correctOption) || !subjectName || !lectureName) {
        alert("يرجى إدخال جميع الحقول بشكل صحيح");
        return;
      }

      await db.collection("subjects").doc(subjectName).collection("lectures").doc(lectureName).collection("questions").add({
        question: questionText,
        options: optionsText,
        correct: correctOption
      });
      loadQuestions(subjectName, lectureName);
    }

    // تحميل المواد
    async function loadSubjects() {
      const subjectsList = document.getElementById("subjectsList");
      const snapshot = await db.collection("subjects").get();
      subjectsList.innerHTML = "";
      snapshot.forEach(doc => {
        const subject = doc.data();
        const subjectDiv = document.createElement("div");
        subjectDiv.className = "item-box";
        subjectDiv.innerHTML = `
          <strong>${subject.name}</strong>
          <button onclick="deleteSubject('${doc.id}')">حذف</button>
        `;
        subjectsList.appendChild(subjectDiv);

        // تحديث قائمة اختيار المادة
        const subjectSelect = document.getElementById("subjectSelect");
        const subjectSelectForQuestion = document.getElementById("subjectSelectForQuestion");
        const option = document.createElement("option");
        option.value = subject.name;
        option.textContent = subject.name;
        subjectSelect.appendChild(option);
        subjectSelectForQuestion.appendChild(option);
      });
    }

    // تحميل المحاضرات الخاصة بالمادة
    async function loadLecturesForSubject() {
      const subjectName = document.getElementById("subjectSelect").value;
      if (!subjectName) return;

      const lecturesSnapshot = await db.collection("subjects").doc(subjectName).collection("lectures").get();
      const lectureSelect = document.getElementById("lectureSelectForQuestion");
      const lectureSelectForAdd = document.getElementById("lectureSelect");
      lectureSelect.innerHTML = "<option value=''>اختر المحاضرة</option>";
      lectureSelectForAdd.innerHTML = "<option value=''>اختر المحاضرة</option>";

      lecturesSnapshot.forEach(doc => {
        const lecture = doc.data();
        const option = document.createElement("option");
        option.value = lecture.name;
        option.textContent = lecture.name;
        lectureSelect.appendChild(option);
        lectureSelectForAdd.appendChild(option);
      });
    }

    // تحميل الأسئلة
    async function loadQuestions(subjectName, lectureName) {
      const questionsContainer = document.getElementById("questionsContainer");
      const snapshot = await db.collection("subjects").doc(subjectName).collection("lectures").doc(lectureName).collection("questions").get();
      questionsContainer.innerHTML = "";
      snapshot.forEach(doc => {
        const q = doc.data();
        const div = document.createElement("div");
        div.className = "item-box";
        div.innerHTML = `<strong>Q:</strong> ${q.question}<br>
          ${q.options.map((opt, i) => `${String.fromCharCode(65 + i)}- ${opt}`).join("<br>")}
          <br><strong>الصحيح:</strong> ${String.fromCharCode(65 + q.correct)}
          <button class="delete-btn" onclick="deleteQuestion('${doc.id}')">حذف</button>`;
        questionsContainer.appendChild(div);
      });
    }

    // حذف مادة
    async function deleteSubject(id) {
      await db.collection("subjects").doc(id).delete();
      loadSubjects();
    }

    loadSubjects();
  </script>

</body>
</html>
