<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>لوحة التحكم - Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; background: #f2f2f2; padding: 20px; margin: 0; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px #ccc; }
    h2 { text-align: center; color: #333; }
    input, textarea, select, button { width: 100%; padding: 10px; margin-top: 10px; }
    .box { margin-top: 20px; padding: 10px; background: #f9f9f9; border-radius: 8px; border: 1px solid #ccc; }
    .delete-btn { color: white; background: red; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; float: left; }
    .item { padding: 8px 15px; margin-top: 10px; background: #f1f1f1; border-radius: 8px; cursor: pointer; }
    .item:hover { background-color: #e0e0e0; }
    .controls { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>

  <div class="container">
    <h2>لوحة التحكم - إضافة مادة/محاضرة/سؤال</h2>

    <h3>إضافة مادة</h3>
    <input type="text" id="subjectName" placeholder="أدخل اسم المادة" />
    <button onclick="addSubject()">إضافة مادة</button>

    <h3>إضافة محاضرة</h3>
    <select id="subjectSelect">
      <option value="">اختر مادة لإضافة محاضرة</option>
    </select>
    <input type="text" id="lectureName" placeholder="أدخل اسم المحاضرة" />
    <button onclick="addLecture()">إضافة محاضرة</button>

    <h3>إضافة سؤال</h3>
    <select id="lectureSelect">
      <option value="">اختر محاضرة لإضافة سؤال</option>
    </select>
    <textarea id="questionText" placeholder="اكتب نص السؤال"></textarea>
    <textarea id="optionsText" placeholder="اكتب الخيارات، كل خيار في سطر"></textarea>
    <select id="correctAnswer">
      <option value="">اختر الإجابة الصحيحة</option>
      <option value="0">الخيار 1</option>
      <option value="1">الخيار 2</option>
      <option value="2">الخيار 3</option>
      <option value="3">الخيار 4</option>
      <option value="4">الخيار 5</option>
    </select>
    <button onclick="addQuestion()">إضافة سؤال</button>

    <h3>جميع المواد والمحاضرات</h3>
    <div id="subjectsList"></div>
  </div>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyBfaMxkaF-QRPdf24gYCJKeLMarNNQLaBQ",
  authDomain: "storage-5ba27.firebaseapp.com",
  projectId: "storage-5ba27",
  storageBucket: "storage-5ba27.firebasestorage.app",
  messagingSenderId: "911744755254",
  appId: "1:911744755254:web:b05fea1f2d26ba9738da97",
  measurementId: "G-SVE6LCGBGE"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function loadSubjects() {
      const subjectSelect = document.getElementById('subjectSelect');
      const subjectsList = document.getElementById('subjectsList');
      subjectSelect.innerHTML = '<option value="">اختر مادة لإضافة محاضرة</option>';

      const snapshot = await db.collection('subjects').get();
      subjectsList.innerHTML = ''; // إعادة تحميل المواد
      snapshot.forEach(doc => {
        const subject = doc.data();
        const subjectDiv = document.createElement('div');
        subjectDiv.classList.add('item');
        subjectDiv.textContent = subject.name;

        const deleteBtn = document.createElement('button');
        deleteBtn.classList.add('delete-btn');
        deleteBtn.textContent = 'حذف';
        deleteBtn.onclick = () => deleteSubject(doc.id);

        subjectDiv.appendChild(deleteBtn);
        subjectsList.appendChild(subjectDiv);

        // إضافة المادة في قائمة الاختيارات
        const option = document.createElement('option');
        option.value = doc.id;
        option.textContent = subject.name;
        subjectSelect.appendChild(option);
      });
    }

    async function addSubject() {
      const subjectName = document.getElementById('subjectName').value;
      if (!subjectName) return alert('يرجى إدخال اسم المادة');

      await db.collection('subjects').add({ name: subjectName });
      document.getElementById('subjectName').value = '';
      loadSubjects();
    }

    async function deleteSubject(subjectId) {
      const subjectDoc = db.collection('subjects').doc(subjectId);
      const lecturesSnapshot = await subjectDoc.collection('lectures').get();
      lecturesSnapshot.forEach(doc => {
        doc.ref.delete(); // حذف المحاضرات المرتبطة
      });
      await subjectDoc.delete();
      loadSubjects();
    }

    async function addLecture() {
      const subjectId = document.getElementById('subjectSelect').value;
      const lectureName = document.getElementById('lectureName').value;
      if (!subjectId || !lectureName) return alert('يرجى تحديد المادة وإدخال اسم المحاضرة');

      await db.collection('subjects').doc(subjectId).collection('lectures').add({ name: lectureName });
      document.getElementById('lectureName').value = '';
      loadSubjects();
    }

    async function addQuestion() {
      const lectureId = document.getElementById('lectureSelect').value;
      const questionText = document.getElementById('questionText').value;
      const optionsText = document.getElementById('optionsText').value;
      const correctAnswer = parseInt(document.getElementById('correctAnswer').value);

      if (!lectureId || !questionText || !optionsText || isNaN(correctAnswer)) return alert('يرجى ملء جميع الحقول');

      const options = optionsText.split('\n');
      await db.collection('lectures').doc(lectureId).collection('questions').add({
        question: questionText,
        options: options,
        correct: correctAnswer
      });
      document.getElementById('questionText').value = '';
      document.getElementById('optionsText').value = '';
      document.getElementById('correctAnswer').value = '';
      loadSubjects();
    }

    async function loadLectures(subjectId) {
      const lectureSelect = document.getElementById('lectureSelect');
      lectureSelect.innerHTML = '<option value="">اختر محاضرة لإضافة سؤال</option>';

      const snapshot = await db.collection('subjects').doc(subjectId).collection('lectures').get();
      snapshot.forEach(doc => {
        const lecture = doc.data();
        const option = document.createElement('option');
        option.value = doc.id;
        option.textContent = lecture.name;
        lectureSelect.appendChild(option);
      });
    }

    loadSubjects();
  </script>

</body>
</html>
